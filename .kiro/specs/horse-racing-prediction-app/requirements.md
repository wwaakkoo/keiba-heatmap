# 競馬予想アプリ要件定義書

## はじめに

統計分析ベースの競馬予想アプリを開発し、データドリブンな意思決定により感情に左右されない合理的な競馬投資を実現する。Phase 1では基本的な予想機能と収支管理に焦点を当て、最低限使用できるMVPを構築する。

## 要件

### 要件1: 基本予想機能

**ユーザーストーリー:** 競馬ファンとして、中央競馬の単勝予想を統計的に分析して、期待値の高い馬を特定したい。

#### 受入基準

1. WHEN ユーザーがレース情報を入力 THEN システムは基礎スコアを計算 SHALL する
2. WHEN 基礎スコアが計算完了 THEN システムは期待値（推定勝率 × オッズ × 信頼度係数）を算出 SHALL する
3. WHEN 期待値が120%以上 THEN システムは推奨馬として表示 SHALL する
4. WHEN 土日のメインレース（20-30レース）を対象 THEN システムは予想を提供 SHALL する

### 要件2: データ入力機能

**ユーザーストーリー:** ユーザーとして、netkeibaからの情報を効率的に入力して、予想に必要なデータを蓄積したい。

#### 受入基準

1. WHEN ユーザーがnetkeibaからコピーしたデータを貼り付け THEN システムは自動的にパース SHALL する
2. WHEN 基本情報（馬番、馬名、性別、年齢、斤量）が入力 THEN システムは必須項目として保存 SHALL する
3. WHEN オッズ情報（単勝オッズ、複勝オッズ範囲）が入力 THEN システムは予想計算に使用 SHALL する
4. WHEN 騎手・調教師情報が入力 THEN システムはデータベースに蓄積 SHALL する
5. WHEN 入力値に異常値が検出 THEN システムは警告を表示 SHALL する

### 要件3: 収支管理機能

**ユーザーストーリー:** 投資家として、競馬投資の収支を正確に記録・管理して、資金管理を適切に行いたい。

#### 受入基準

1. WHEN ユーザーが初期資金を設定 THEN システムは残高を追跡 SHALL する
2. WHEN 投資を実行 THEN システムは資金の1-5%ルールに基づいて投資単位を計算 SHALL する
3. WHEN レース結果を入力 THEN システムは収支を自動更新 SHALL する
4. WHEN 日次損失が上限に達した THEN システムはアラートを表示 SHALL する

### 要件4: データ永続化機能

**ユーザーストーリー:** ユーザーとして、入力したデータや予想結果を安全に保存して、次回利用時に継続して使用したい。

#### 受入基準

1. WHEN データが入力または更新 THEN システムはIndexedDBに保存 SHALL する
2. WHEN 馬情報が再入力 THEN システムは過去データを自動補完 SHALL する
3. WHEN ユーザーがデータエクスポートを要求 THEN システムはJSONファイルを生成 SHALL する
4. WHEN ユーザーがデータインポートを実行 THEN システムは既存データとマージ SHALL する

### 要件5: 基本分析機能

**ユーザーストーリー:** ユーザーとして、予想の精度と投資パフォーマンスを分析して、改善点を把握したい。

#### 受入基準

1. WHEN ユーザーが分析画面を開く THEN システムは期間別収支推移を表示 SHALL する
2. WHEN 予想結果が蓄積 THEN システムは的中率と回収率を計算 SHALL する
3. WHEN 期待値と実績に乖離が発生 THEN システムは差異を可視化 SHALL する
4. WHEN 連敗が発生 THEN システムは改善提案を表示 SHALL する

### 要件6: ユーザーインターフェース

**ユーザーストーリー:** ユーザーとして、モバイルデバイスでも使いやすいレスポンシブなインターフェースで効率的に操作したい。

#### 受入基準

1. WHEN ユーザーがモバイルデバイスでアクセス THEN システムはモバイル最適化されたUIを表示 SHALL する
2. WHEN ユーザーがダークモードを選択 THEN システムはダークテーマを適用 SHALL する
3. WHEN データ入力時間が3分を超過 THEN システムは入力効率化の提案を表示 SHALL する
4. WHEN 予想計算が3秒を超過 THEN システムは処理中インジケーターを表示 SHALL する

### 要件7: PWA対応

**ユーザーストーリー:** ユーザーとして、オフライン環境でも基本機能を使用して、ネイティブアプリのような体験を得たい。

#### 受入基準

1. WHEN ユーザーがオフライン状態 THEN システムはキャッシュされたデータで予想機能を提供 SHALL する
2. WHEN ユーザーがホーム画面に追加を選択 THEN システムはPWAとしてインストール SHALL する
3. WHEN レース開始30分前 THEN システムはプッシュ通知を送信 SHALL する
4. WHEN オンライン復帰時 THEN システムは未同期データを自動同期 SHALL する
